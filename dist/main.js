/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./index.ts":
/*!******************!*\
  !*** ./index.ts ***!
  \******************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _src_app__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/app */ \"./src/app.ts\");\n\nconst app = new _src_app__WEBPACK_IMPORTED_MODULE_0__.App();\napp.start();\n\n\n//# sourceURL=webpack://Safari-Clean-Newtab/./index.ts?");

/***/ }),

/***/ "./src/app.class.ts":
/*!**************************!*\
  !*** ./src/app.class.ts ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"Config\": () => (/* binding */ Config),\n/* harmony export */   \"ImageSource\": () => (/* binding */ ImageSource),\n/* harmony export */   \"SearchEngine\": () => (/* binding */ SearchEngine),\n/* harmony export */   \"ImageSize\": () => (/* binding */ ImageSize),\n/* harmony export */   \"Shortcut\": () => (/* binding */ Shortcut),\n/* harmony export */   \"ImageInfo\": () => (/* binding */ ImageInfo)\n/* harmony export */ });\n/**\n * User Settings\n */\nclass Config {\n    constructor() {\n        this.version = 1;\n        this.source = ImageSource.unsplash;\n        this.count = 10;\n        this.search = SearchEngine.google;\n        this.history = false;\n        this.size = ImageSize.regular;\n        this.keyword = 'sakura';\n        this.shortcuts = [];\n    }\n}\nvar ImageSource;\n(function (ImageSource) {\n    ImageSource[ImageSource[\"unsplash\"] = 0] = \"unsplash\";\n    ImageSource[ImageSource[\"bing\"] = 1] = \"bing\";\n    ImageSource[ImageSource[\"local\"] = 2] = \"local\";\n})(ImageSource || (ImageSource = {}));\nvar SearchEngine;\n(function (SearchEngine) {\n    SearchEngine[SearchEngine[\"google\"] = 0] = \"google\";\n    SearchEngine[SearchEngine[\"bing\"] = 1] = \"bing\";\n})(SearchEngine || (SearchEngine = {}));\nvar ImageSize;\n(function (ImageSize) {\n    ImageSize[ImageSize[\"raw\"] = 0] = \"raw\";\n    ImageSize[ImageSize[\"full\"] = 1] = \"full\";\n    ImageSize[ImageSize[\"regular\"] = 2] = \"regular\";\n    ImageSize[ImageSize[\"small\"] = 3] = \"small\";\n})(ImageSize || (ImageSize = {}));\n/**\n * Shortcut Button\n */\nclass Shortcut {\n    constructor() {\n        this.title = '';\n        this.link = '';\n        this.img = '';\n    }\n}\n/**\n * Image Information\n */\nclass ImageInfo {\n}\n\n\n//# sourceURL=webpack://Safari-Clean-Newtab/./src/app.class.ts?");

/***/ }),

/***/ "./src/app.ts":
/*!********************!*\
  !*** ./src/app.ts ***!
  \********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"App\": () => (/* binding */ App)\n/* harmony export */ });\n/* harmony import */ var _app_class__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./app.class */ \"./src/app.class.ts\");\n/* harmony import */ var _common__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./common */ \"./src/common.ts\");\n/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./config */ \"./src/config.ts\");\nvar __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\n\n\n\n\nHTMLElement.prototype.addClass = function (className) {\n    if (!this.classList.contains(className)) {\n        this.classList.add(className);\n    }\n};\nHTMLElement.prototype.removeClass = function (className) {\n    if (this.classList.contains(className)) {\n        this.classList.remove(className);\n    }\n};\nHTMLElement.prototype.toggleClass = function (className) {\n    if (!this.classList.contains(className)) {\n        this.classList.add(className);\n    }\n    else {\n        this.classList.remove(className);\n    }\n};\nHTMLElement.prototype.val = function (value) {\n    if (value) {\n        this.value = value;\n    }\n    return this.value;\n};\nclass App {\n    constructor() {\n        this.currentConfig = _config__WEBPACK_IMPORTED_MODULE_2__.DefaultConfig;\n    }\n    start() {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield this.waitDocumentReady();\n            _common__WEBPACK_IMPORTED_MODULE_1__.Storage.initialize();\n            _common__WEBPACK_IMPORTED_MODULE_1__.QueryDB.initialize();\n            this.loadConfig();\n            _common__WEBPACK_IMPORTED_MODULE_1__.DOM.load();\n            _common__WEBPACK_IMPORTED_MODULE_1__.DOM.textBox.focus();\n            this.applyShortcuts();\n            this.addListener();\n            this.initialSettings();\n            yield this.refreshWallpaper();\n        });\n    }\n    loadConfig() {\n        const config = _common__WEBPACK_IMPORTED_MODULE_1__.Storage.getItem('config');\n        if (config) {\n            this.currentConfig = config;\n        }\n        else {\n            _common__WEBPACK_IMPORTED_MODULE_1__.Storage.setItem('config', this.currentConfig);\n        }\n    }\n    refreshWallpaper() {\n        return __awaiter(this, void 0, void 0, function* () {\n            let image = _common__WEBPACK_IMPORTED_MODULE_1__.Storage.getItem('imageinfo');\n            if (!image) {\n                image = yield _common__WEBPACK_IMPORTED_MODULE_1__.ImageFetcher.fetch(this.currentConfig.source, this.currentConfig.size, this.currentConfig.keyword);\n            }\n            if (image) {\n                const img = yield _common__WEBPACK_IMPORTED_MODULE_1__.ImageFetcher.loadImage(image, this.currentConfig.size);\n                _common__WEBPACK_IMPORTED_MODULE_1__.ImageFetcher.refresh(img);\n                _common__WEBPACK_IMPORTED_MODULE_1__.ImageFetcher.writeInfo(image);\n                window.requestAnimationFrame(() => {\n                    img.addClass('show');\n                });\n            }\n            image = yield _common__WEBPACK_IMPORTED_MODULE_1__.ImageFetcher.fetch(this.currentConfig.source, this.currentConfig.size, this.currentConfig.keyword);\n            if (image) {\n                const img = yield _common__WEBPACK_IMPORTED_MODULE_1__.ImageFetcher.loadImage(image, this.currentConfig.size);\n                img.remove();\n                _common__WEBPACK_IMPORTED_MODULE_1__.Storage.setItem('imageinfo', image);\n            }\n        });\n    }\n    addListener() {\n        _common__WEBPACK_IMPORTED_MODULE_1__.DOM.textBox.addEventListener('keydown', (e) => __awaiter(this, void 0, void 0, function* () {\n            const element = e.target;\n            const code = (e.keyCode ? e.keyCode : e.which);\n            element.setAttribute('lastkey', code.toString());\n            const query = _common__WEBPACK_IMPORTED_MODULE_1__.DOM.query(\"#textInput\").val();\n            if (code == 13 && query) {\n                if (this.currentConfig.history) {\n                    yield _common__WEBPACK_IMPORTED_MODULE_1__.QueryDB.updateQuery(query.toLocaleLowerCase());\n                }\n                let url = '';\n                if (_common__WEBPACK_IMPORTED_MODULE_1__.Util.isURL(query)) {\n                    if (query.indexOf(\"http\") == 0) {\n                        url = query;\n                    }\n                    else {\n                        url = \"http://\" + query;\n                    }\n                }\n                else {\n                    if (this.currentConfig.search == _app_class__WEBPACK_IMPORTED_MODULE_0__.SearchEngine.google) {\n                        url = `https://www.google.com/search?q=${query}`;\n                    }\n                    else {\n                        url = `https://bing.com/search?q=${query}`;\n                    }\n                }\n                document.location = url;\n            }\n        }));\n        _common__WEBPACK_IMPORTED_MODULE_1__.DOM.textBox.addEventListener('input', (e) => __awaiter(this, void 0, void 0, function* () {\n            var _a;\n            const element = e.target;\n            if (element) {\n                const query = ((_a = element.val()) === null || _a === void 0 ? void 0 : _a.toLocaleLowerCase()) || '';\n                let suggestion = element.getAttribute('suggestion') || '';\n                if (this.currentConfig.history && query.length > 1 && query.length !== suggestion.length && element.getAttribute('lastkey') !== '8') {\n                    const data = yield _common__WEBPACK_IMPORTED_MODULE_1__.QueryDB.getQuery(query);\n                    if (data && data.value && data.value.query) {\n                        suggestion = data.value.query;\n                        const text = element.val() + suggestion.slice(query.length);\n                        element.val(text);\n                        element.setAttribute('suggestion', suggestion);\n                        element.selectionStart = query.length;\n                        element.selectionEnd = suggestion.length;\n                    }\n                }\n            }\n            _common__WEBPACK_IMPORTED_MODULE_1__.DOM.query(\"#searchBar\").addClass(\"searchBarFocused\");\n            _common__WEBPACK_IMPORTED_MODULE_1__.Util.debounce(() => {\n                _common__WEBPACK_IMPORTED_MODULE_1__.DOM.query(\"#searchBar\").removeClass(\"searchBarFocused\");\n            }, 5000)();\n        }));\n        _common__WEBPACK_IMPORTED_MODULE_1__.DOM.bottomBar.addEventListener('mouseenter', () => _common__WEBPACK_IMPORTED_MODULE_1__.DOM.siteBox.addClass('mousein'));\n        _common__WEBPACK_IMPORTED_MODULE_1__.DOM.bottomBar.addEventListener('mouseleave', () => _common__WEBPACK_IMPORTED_MODULE_1__.DOM.siteBox.removeClass('mousein'));\n        _common__WEBPACK_IMPORTED_MODULE_1__.DOM.settingIcon.addEventListener('click', () => {\n            _common__WEBPACK_IMPORTED_MODULE_1__.DOM.settingPanel.toggleClass('show');\n        });\n        _common__WEBPACK_IMPORTED_MODULE_1__.DOM.settingClose.addEventListener('click', () => {\n            _common__WEBPACK_IMPORTED_MODULE_1__.DOM.settingPanel.removeClass('show');\n        });\n        document.addEventListener('keydown', (e) => {\n            if ((e.which == 17 || e.which == 91) && _common__WEBPACK_IMPORTED_MODULE_1__.DOM.siteBox.classList.contains('mousein')) {\n                _common__WEBPACK_IMPORTED_MODULE_1__.DOM.siteBox.addClass('editing');\n            }\n        });\n        document.addEventListener('keyup', (e) => {\n            if ((e.which == 17 || e.which == 91)) {\n                _common__WEBPACK_IMPORTED_MODULE_1__.DOM.siteBox.removeClass('editing');\n            }\n        });\n        _common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('.settingButton.cancel').addEventListener('click', () => {\n            _common__WEBPACK_IMPORTED_MODULE_1__.DOM.settingPanel.removeClass('show');\n        });\n        _common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('.settingButton.submit').addEventListener('click', () => {\n            this.currentConfig.source = _app_class__WEBPACK_IMPORTED_MODULE_0__.ImageSource[_common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('[data-key=\\'source\\']').val()];\n            this.currentConfig.count = parseInt(_common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('[data-key=\\'count\\']').val() || '');\n            this.currentConfig.search = _app_class__WEBPACK_IMPORTED_MODULE_0__.SearchEngine[_common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('[data-key=\\'search\\']').val()];\n            this.currentConfig.history = _common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('[data-key=\\'history\\']').val() == 'true';\n            this.currentConfig.size = _app_class__WEBPACK_IMPORTED_MODULE_0__.ImageSize[_common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('[data-key=\\'size\\']').val()];\n            this.currentConfig.keyword = _common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('[data-key=\\'keyword\\']').val() || '';\n            _common__WEBPACK_IMPORTED_MODULE_1__.Storage.setItem('config', this.currentConfig);\n            _common__WEBPACK_IMPORTED_MODULE_1__.DOM.settingPanel.removeClass('show');\n        });\n        _common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('.settingButton.add').addEventListener('click', () => {\n            const shortcut = new _app_class__WEBPACK_IMPORTED_MODULE_0__.Shortcut();\n            shortcut.title = _common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('[data-key=\\'shortcutTitle\\']').val() || '';\n            shortcut.link = _common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('[data-key=\\'shortcutLink\\']').val() || '';\n            shortcut.img = _common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('[data-key=\\'shortcutImage\\']').val() || '';\n            const node = document.createElement('a');\n            node.href = shortcut.link;\n            node.title = shortcut.title;\n            node.className = 'siteButton';\n            node.innerHTML = `\n        <img src=\"${shortcut.img}\" class=\"siteIcon\"><i></i>\n        <div class=\"siteTitle\">${shortcut.title}</div>`.trim();\n            this.addShortcutListener(node);\n            node.addClass('hide');\n            _common__WEBPACK_IMPORTED_MODULE_1__.DOM.siteBox.insertBefore(node, _common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('.siteButton.add'));\n            window.requestAnimationFrame(() => {\n                node.removeClass('hide');\n            });\n            this.currentConfig.shortcuts.push(shortcut);\n            _common__WEBPACK_IMPORTED_MODULE_1__.Storage.setItem('config', this.currentConfig);\n            _common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('.settingPanel.shortcut').removeClass('show');\n        });\n        _common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('.settingButton.leave').addEventListener('click', () => {\n            _common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('.settingPanel.shortcut').removeClass('show');\n        });\n        _common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('.settingButton.image').addEventListener('click', () => __awaiter(this, void 0, void 0, function* () {\n            const term = _common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('[data-key=\\'shortcutTitle\\']').val();\n            if (!term || term.length === 0) {\n                return;\n            }\n            _common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('.settingButton.image').addClass('disabled');\n            let content = '';\n            (yield _common__WEBPACK_IMPORTED_MODULE_1__.ImageFetcher.getIconImageList(term)).forEach((item, idx) => {\n                if (idx >= 5) {\n                    return;\n                }\n                content += `<img src=\"${item}\" alt=\"${term}\">`;\n            });\n            _common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('.settingItem.full.image').innerHTML = content;\n            _common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('.settingButton.image').removeClass('disabled');\n        }));\n        _common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('.settingItem.full.image').addEventListener('click', (e) => {\n            var _a;\n            if (e.target.nodeName == 'IMG') {\n                _common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('[data-key=\\'shortcutImage\\']').val((_a = e.target.getAttribute('src')) === null || _a === void 0 ? void 0 : _a.replace('60x60bb', '256x256bb'));\n            }\n        });\n        document.body.addEventListener('mousemove', (e) => {\n            const button = _common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('.siteButton.dragging');\n            if (button) {\n                button.style.left = (e.pageX - _common__WEBPACK_IMPORTED_MODULE_1__.DOM.siteBox.getBoundingClientRect().left - parseInt(button.getAttribute('ox') || '')) + 'px';\n                button.style.top = (e.pageY - _common__WEBPACK_IMPORTED_MODULE_1__.DOM.siteBox.getBoundingClientRect().top - parseInt(button.getAttribute('oy') || '')) + 'px';\n                let index = -1;\n                _common__WEBPACK_IMPORTED_MODULE_1__.DOM.queryAll('.siteButton:not(.hide)').forEach((element, idx) => {\n                    if (element === button) {\n                        index = idx;\n                    }\n                });\n                _common__WEBPACK_IMPORTED_MODULE_1__.DOM.queryAll('.siteButton:not(.add)').forEach((element, idx) => {\n                    if (index == -1) {\n                        return;\n                    }\n                    if (idx < index && element.offsetLeft > button.offsetLeft - button.offsetWidth / 2) {\n                        element.addClass('moveRight');\n                    }\n                    else if (idx > index && element.offsetLeft < button.offsetLeft + button.offsetWidth / 2) {\n                        element.addClass('moveLeft');\n                    }\n                    else {\n                        element.removeClass('moveLeft');\n                        element.removeClass('moveRight');\n                    }\n                });\n            }\n        });\n        let observer = new ResizeObserver(entries => {\n            for (const entry of entries) {\n                if (entry.target == _common__WEBPACK_IMPORTED_MODULE_1__.DOM.bottomBar) {\n                    const width = entry.contentRect.width / entry.contentRect.height * 200;\n                    const mask = `url('data:image/svg+xml;utf8,<svg preserveAspectRatio=\"none\" viewBox=\"0 0 ${width} 200\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M 100 0 c -90 0 -100 10 -100 100 c 0 90 10 100 100 100 l ${width - 200} 0 c 90 0, 100 -10, 100 -100 c 0 -90, -10 -100, -100 -100Z\" fill=\"white\"></path></svg>')`;\n                    _common__WEBPACK_IMPORTED_MODULE_1__.DOM.bottomGlass.style.mask = mask;\n                    _common__WEBPACK_IMPORTED_MODULE_1__.DOM.bottomGlass.style.webkitMaskImage = mask;\n                }\n                else if (entry.target == _common__WEBPACK_IMPORTED_MODULE_1__.DOM.searchBar) {\n                    const width = entry.contentRect.width / entry.contentRect.height * 200;\n                    const mask = `url('data:image/svg+xml;utf8,<svg preserveAspectRatio=\"none\" viewBox=\"0 0 ${width} 200\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M 100 0 l -30 0 c -45 0 -70 25 -70 70 l 0 60 c 0 45 25 70 70 70 l 30 0 l ${width - 200} 0 l 30 0 c 45 0, 70 -25, 70 -70 l 0 -60 c 0 -45, -25 -70, -70 -70Z\" fill=\"white\"></path></svg>')`;\n                    _common__WEBPACK_IMPORTED_MODULE_1__.DOM.searchGlass.style.mask = mask;\n                    _common__WEBPACK_IMPORTED_MODULE_1__.DOM.searchGlass.style.webkitMaskImage = mask;\n                }\n            }\n        });\n        observer.observe(_common__WEBPACK_IMPORTED_MODULE_1__.DOM.bottomBar);\n        observer.observe(_common__WEBPACK_IMPORTED_MODULE_1__.DOM.searchBar);\n    }\n    addShortcutListener(node) {\n        node.addEventListener('mousedown', (e) => {\n            e.preventDefault();\n            const button = e.currentTarget;\n            if (button.classList.contains('add')) {\n                return;\n            }\n            else if (!_common__WEBPACK_IMPORTED_MODULE_1__.DOM.siteBox.classList.contains('editing')) {\n                return;\n            }\n            else if (e.target.nodeName == 'I') {\n                return;\n            }\n            button.addClass('dragging');\n            button.setAttribute('ox', (e.pageX - _common__WEBPACK_IMPORTED_MODULE_1__.DOM.siteBox.getBoundingClientRect().left).toString());\n            button.setAttribute('oy', (e.pageY - _common__WEBPACK_IMPORTED_MODULE_1__.DOM.siteBox.getBoundingClientRect().top).toString());\n        });\n        node.addEventListener('mouseup', (e) => {\n            e.preventDefault();\n            const button = e.currentTarget;\n            if (button.classList.contains('add')) {\n                return;\n            }\n            else if (!button.classList.contains('dragging')) {\n                return;\n            }\n            else if (e.target.nodeName == 'I') {\n                return;\n            }\n            const left = button.getBoundingClientRect().left;\n            const top = button.getBoundingClientRect().top;\n            let index = -1;\n            _common__WEBPACK_IMPORTED_MODULE_1__.DOM.queryAll('.siteButton:not(.hide)').forEach((element, idx) => {\n                if (element === button) {\n                    index = idx;\n                }\n            });\n            const offset = _common__WEBPACK_IMPORTED_MODULE_1__.DOM.queryAll('.siteButton.moveLeft').length - _common__WEBPACK_IMPORTED_MODULE_1__.DOM.queryAll('.siteButton.moveRight').length;\n            const shortcut = this.currentConfig.shortcuts[index];\n            this.currentConfig.shortcuts.splice(index, 1);\n            this.currentConfig.shortcuts.splice(index + offset, 0, shortcut);\n            _common__WEBPACK_IMPORTED_MODULE_1__.Storage.setItem('config', this.currentConfig);\n            this.applyShortcuts();\n            _common__WEBPACK_IMPORTED_MODULE_1__.DOM.queryAll('.siteButton:not(.hide)').forEach((element, idx) => {\n                if (idx === index + offset) {\n                    element.style.transform = `translate(${left - element.getBoundingClientRect().left}px,${top - element.getBoundingClientRect().top}px)`;\n                    element.style.transition = 'none';\n                    window.requestAnimationFrame(() => {\n                        element.style.removeProperty('transform');\n                        element.style.removeProperty('transition');\n                    });\n                }\n            });\n        });\n        node.addEventListener('click', (e) => {\n            var _a;\n            const button = e.currentTarget;\n            if (e.target.nodeName == 'I') {\n                let index = -1;\n                _common__WEBPACK_IMPORTED_MODULE_1__.DOM.queryAll('.siteButton:not(.hide)').forEach((element, idx) => {\n                    if (element === button) {\n                        index = idx;\n                    }\n                });\n                if (index !== -1) {\n                    this.currentConfig.shortcuts = this.currentConfig.shortcuts.filter((element, idx) => {\n                        return idx != index;\n                    });\n                    _common__WEBPACK_IMPORTED_MODULE_1__.Storage.setItem('config', this.currentConfig);\n                }\n                (_a = e.currentTarget) === null || _a === void 0 ? void 0 : _a.addClass('hide');\n                e.preventDefault();\n            }\n            else if (button.classList.contains('add')) {\n                _common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('[data-key=\\'shortcutTitle\\']').val('');\n                _common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('[data-key=\\'shortcutLink\\']').val('');\n                _common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('[data-key=\\'shortcutImage\\']').val('');\n                _common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('.settingItem.full.image').innerHTML = '';\n                _common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('.settingPanel.config').removeClass('show');\n                _common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('.settingPanel.shortcut').toggleClass('show');\n                e.preventDefault();\n            }\n            else if (button.classList.contains('dragging')) {\n                e.preventDefault();\n            }\n            else if (!_common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('#sites').classList.contains('editing')) {\n                _common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('.siteButton').removeClass('click');\n                button.addClass('click');\n            }\n        });\n    }\n    applyShortcuts() {\n        if (this.currentConfig) {\n            let content = '';\n            this.currentConfig.shortcuts.map((element) => {\n                const template = `\n<a href=\"${element.link}\" title=\"${element.title}\" class=\"siteButton\">\n<img src=\"${element.img}\" class=\"siteIcon\">\n<i></i>\n<div class=\"siteTitle\">${element.title}</div>\n</a>`;\n                content += template.trim();\n            });\n            content += `\n<a href=\"#AddShortcut\" title=\"Add Shortcut\" class=\"siteButton add\">\n<div class=\"siteIcon\"></div>\n<div class=\"siteTitle\">Add Shortcut</div>\n</a>`.trim();\n            _common__WEBPACK_IMPORTED_MODULE_1__.DOM.siteBox.innerHTML = content;\n            _common__WEBPACK_IMPORTED_MODULE_1__.DOM.queryAll('.siteButton').forEach((node) => this.addShortcutListener(node));\n        }\n    }\n    waitDocumentReady() {\n        return new Promise((resolve, reject) => {\n            if (document.readyState === 'complete' || document.readyState === 'interactive') {\n                resolve(true);\n            }\n            else {\n                const callback = () => {\n                    document.removeEventListener('DOMContentLoaded', callback);\n                    resolve(true);\n                };\n                document.addEventListener('DOMContentLoaded', callback);\n            }\n        });\n    }\n    initialSettings() {\n        _common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('[data-key=\\'source\\']').val(_app_class__WEBPACK_IMPORTED_MODULE_0__.ImageSource[this.currentConfig.source]);\n        _common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('[data-key=\\'count\\']').val(this.currentConfig.count.toString());\n        _common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('[data-key=\\'search\\']').val(_app_class__WEBPACK_IMPORTED_MODULE_0__.SearchEngine[this.currentConfig.search]);\n        _common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('[data-key=\\'history\\']').val((this.currentConfig.history || false).toString());\n        _common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('[data-key=\\'size\\']').val(_app_class__WEBPACK_IMPORTED_MODULE_0__.ImageSize[this.currentConfig.size]);\n        _common__WEBPACK_IMPORTED_MODULE_1__.DOM.query('[data-key=\\'keyword\\']').val(this.currentConfig.keyword);\n    }\n}\n\n\n//# sourceURL=webpack://Safari-Clean-Newtab/./src/app.ts?");

/***/ }),

/***/ "./src/common.ts":
/*!***********************!*\
  !*** ./src/common.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"Util\": () => (/* binding */ Util),\n/* harmony export */   \"DOM\": () => (/* binding */ DOM),\n/* harmony export */   \"ImageFetcher\": () => (/* binding */ ImageFetcher),\n/* harmony export */   \"Storage\": () => (/* binding */ Storage),\n/* harmony export */   \"QueryDB\": () => (/* binding */ QueryDB)\n/* harmony export */ });\n/* harmony import */ var _app_class__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./app.class */ \"./src/app.class.ts\");\nvar __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\n\nclass Util {\n    static debounce(func, wait) {\n        let timeout;\n        return (...args) => {\n            const later = () => {\n                clearTimeout(timeout);\n                func(...args);\n            };\n            clearTimeout(timeout);\n            timeout = setTimeout(later, wait);\n        };\n    }\n    static isURL(query) {\n        const urlRegex = /^(http:\\/\\/www\\.|https:\\/\\/www\\.|http:\\/\\/|https:\\/\\/)?[a-z0-9]+([\\-\\.]{1}[a-z0-9]+)*\\.[a-z]{2,6}(:[0-9]{1,5})?(\\/.*)?$/ig;\n        return query.length < 2083 && urlRegex.test(query);\n    }\n}\n/**\n * DOM API\n */\nclass DOM {\n    /**\n     * Load common nodes\n     */\n    static load() {\n        this.textBox = document.querySelector('#textInput');\n        this.siteBox = document.querySelector('#sites');\n        this.searchBar = document.querySelector('#searchBar');\n        this.searchGlass = document.querySelector('#searchBar>.backglass');\n        this.bottomBar = document.querySelector('#bottomBar');\n        this.bottomGlass = document.querySelector('#bottomBar>.backglass');\n        this.settingIcon = document.querySelector('#settingIcon');\n        this.settingPanel = document.querySelector('#settingPanel');\n        this.settingClose = document.querySelector('#settingClose');\n        this.cover = document.querySelector('#cover');\n    }\n    /**\n     * Select one node\n     * @param  {string} selector Selector\n     * @return {HTMLElement} DOM element\n     */\n    static query(selector) {\n        return document.querySelector(selector);\n    }\n    /**\n     * Select multiple nodes\n     * @param  {string} selector Selector\n     * @return {NodeListOf<HTMLElement>} DOM Elements\n     */\n    static queryAll(selector) {\n        return document.querySelectorAll(selector);\n    }\n}\n/**\n * Fetch image resources from web\n */\nclass ImageFetcher {\n    static fetch(source, size, keyword) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const data = yield this.requestImage(source, keyword);\n            return this.resolveData(source, data);\n        });\n    }\n    static refresh(image) {\n        DOM.cover.append(image);\n    }\n    static writeInfo(image) {\n        DOM.query('#imageLink').setAttribute('href', image.url || '');\n        DOM.query('#authorLink').setAttribute('href', image.link || '');\n        DOM.query('#authorLink').innerText = image.author || '';\n        DOM.query('#imageTitle').innerText = image.title || '';\n        DOM.query('#model').innerText = image.brief || '';\n        DOM.query('#location').innerText = image.location || '';\n        DOM.query('#infoText').style.display = 'block';\n        if (image.color) {\n            DOM.query(\"#cover\").style.background = image.color;\n            DOM.query(\"meta[name='theme-color']\").setAttribute('content', image.color);\n        }\n    }\n    static loadImage(image, size) {\n        return new Promise((resolve, reject) => {\n            const img = document.createElement('img');\n            img.src = this.getUrl(image, size) || '';\n            img.addClass('coverImage');\n            img.addEventListener('load', () => {\n                resolve(img);\n            });\n        });\n    }\n    static getUrl(image, size) {\n        switch (size) {\n            case _app_class__WEBPACK_IMPORTED_MODULE_0__.ImageSize.raw:\n                return image.raw;\n            case _app_class__WEBPACK_IMPORTED_MODULE_0__.ImageSize.full:\n                return image.full;\n            case _app_class__WEBPACK_IMPORTED_MODULE_0__.ImageSize.regular:\n                return image.regular;\n            default:\n                return image.small;\n        }\n    }\n    static requestImage(source, keyword) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (source == _app_class__WEBPACK_IMPORTED_MODULE_0__.ImageSource.unsplash) {\n                let url = `https://api.unsplash.com/photos/random?client_id=${this.unsplashID}&orientation=landscape`;\n                if (keyword) {\n                    url += '&query=' + keyword;\n                }\n                return yield fetch(url, { mode: 'cors' }).then((res) => res.json());\n            }\n            else if (source == _app_class__WEBPACK_IMPORTED_MODULE_0__.ImageSource.bing) {\n                const url = `https://www.bing.com/HPImageArchive.aspx?format=js&idx=${Math.floor(Math.random() * 7)}&n=1`;\n                return yield fetch(url, {\n                    mode: 'cors',\n                    headers: {\n                        'X-Requested-With': '',\n                    },\n                }).then((res) => res.json());\n            }\n        });\n    }\n    static resolveData(source, data) {\n        if (source == _app_class__WEBPACK_IMPORTED_MODULE_0__.ImageSource.unsplash) {\n            return this.resolveUnsplashData(data);\n        }\n        else if (source == _app_class__WEBPACK_IMPORTED_MODULE_0__.ImageSource.bing) {\n            return this.resolveBingData(data);\n        }\n        return new _app_class__WEBPACK_IMPORTED_MODULE_0__.ImageInfo();\n    }\n    static resolveUnsplashData(data) {\n        const image = new _app_class__WEBPACK_IMPORTED_MODULE_0__.ImageInfo();\n        let node;\n        if (data && data.results && data.results.length) {\n            node = data.results[0];\n        }\n        else if (data) {\n            node = data;\n        }\n        else {\n            return image;\n        }\n        image.raw = node.urls.raw;\n        image.full = node.urls.full;\n        image.regular = node.urls.regular;\n        image.small = node.urls.small;\n        image.title = '';\n        image.url = node.links.html;\n        image.author = '© Unsplash ' + node.user.name;\n        image.link = node.user.links.html;\n        image.brief = node.exif.name;\n        image.location = node.location.title;\n        image.color = node.color;\n        return image;\n    }\n    static resolveBingData(data) {\n        const image = new _app_class__WEBPACK_IMPORTED_MODULE_0__.ImageInfo();\n        if (data && data.images && data.images.length > 0) {\n            const node = data.images[0];\n            const info = /(.*?)[,|，](.*)\\((.*)\\)/.exec(node.copyright);\n            image.raw = 'https://www.bing.com/' + node.url.replace('1920x1080', 'UHD');\n            image.full = 'https://www.bing.com/' + node.url.replace('1920x1080', 'UHD');\n            image.regular = 'https://www.bing.com/' + node.url;\n            image.small = 'https://www.bing.com/' + node.url.replace('1920x1080', '1366x768');\n            image.url = node.copyrightlink;\n            if (info) {\n                image.title = info[1];\n                image.location = info[2];\n                image.author = info[3];\n            }\n        }\n        return image;\n    }\n    static getIconImageList(term) {\n        return new Promise((resolve, reject) => {\n            const url = `https://itunes.apple.com/search?term=${term}&limit=10&media=software`;\n            fetch(url)\n                .then((res) => res.json())\n                .then((data) => {\n                if (data.results) {\n                    resolve(data.results.map((item) => item.artworkUrl60));\n                }\n                else {\n                    resolve([]);\n                }\n            });\n        });\n    }\n}\nImageFetcher.unsplashID = '691b20a234f612603711b9eabd89df4729a06478f16d7e89cd8526340897b18d';\nclass Storage {\n    static initialize() {\n        try {\n            localStorage;\n        }\n        catch (e) {\n            this.storageEnabled = false;\n            DOM.settingIcon.remove();\n        }\n    }\n    static getItem(key) {\n        if (!this.storageEnabled) {\n            return undefined;\n        }\n        const data = localStorage.getItem(key);\n        if (data) {\n            return JSON.parse(data);\n        }\n        return undefined;\n    }\n    static setItem(key, item) {\n        if (!this.storageEnabled) {\n            return;\n        }\n        localStorage.setItem(key, JSON.stringify(item));\n    }\n}\nStorage.storageEnabled = true;\nclass QueryDB {\n    static initialize() {\n        try {\n            const request = window.indexedDB.open(QueryDB.dbName, QueryDB.dbVersion);\n            request.onupgradeneeded = (e) => {\n                var _a;\n                QueryDB.db = (_a = e.target) === null || _a === void 0 ? void 0 : _a.result;\n                const objectStore = QueryDB.db.createObjectStore(\"queries\", {\n                    keyPath: \"query\",\n                });\n                objectStore.createIndex(\"visit\", \"visit\", {\n                    unique: false,\n                });\n                objectStore.add({\n                    query: \"test\",\n                    visit: 1,\n                });\n            };\n            request.onsuccess = (e) => {\n                var _a;\n                QueryDB.db = (_a = e.target) === null || _a === void 0 ? void 0 : _a.result;\n                this.dbEnabled = true;\n            };\n        }\n        catch (e) {\n            this.dbEnabled = false;\n        }\n    }\n    static updateQuery(query) {\n        return new Promise((resolve, reject) => {\n            if (!QueryDB.dbEnabled) {\n                return resolve(false);\n            }\n            const store = QueryDB.db.transaction(\"queries\", \"readwrite\").objectStore(\"queries\");\n            const request = store.get(query);\n            request.onsuccess = () => {\n                let visit = 1;\n                if (request.result) {\n                    visit = request.result.visit + 1;\n                    store.put({\n                        query,\n                        visit,\n                    });\n                }\n                else {\n                    store.add({\n                        query,\n                        visit,\n                    });\n                }\n                resolve(true);\n            };\n            request.onerror = () => {\n                reject();\n            };\n        });\n    }\n    static getQuery(query) {\n        return new Promise((resolve, reject) => {\n            if (!QueryDB.dbEnabled) {\n                return resolve({});\n            }\n            const request = QueryDB.db.transaction(\"queries\")\n                .objectStore(\"queries\")\n                .openCursor(window.IDBKeyRange.bound(query, query + \"\\uffff\"), \"prev\");\n            request.onsuccess = (e) => {\n                var _a;\n                resolve((_a = e.target) === null || _a === void 0 ? void 0 : _a.result);\n            };\n            request.onerror = () => {\n                reject();\n            };\n        });\n    }\n}\nQueryDB.dbEnabled = false;\nQueryDB.dbName = \"safari_homepage\";\nQueryDB.dbVersion = 2;\n\n\n//# sourceURL=webpack://Safari-Clean-Newtab/./src/common.ts?");

/***/ }),

/***/ "./src/config.ts":
/*!***********************!*\
  !*** ./src/config.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"DefaultConfig\": () => (/* binding */ DefaultConfig)\n/* harmony export */ });\n/* harmony import */ var _app_class__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./app.class */ \"./src/app.class.ts\");\n\nconst DefaultConfig = {\n    'version': 2,\n    'source': _app_class__WEBPACK_IMPORTED_MODULE_0__.ImageSource.unsplash,\n    'count': 10,\n    'search': _app_class__WEBPACK_IMPORTED_MODULE_0__.SearchEngine.google,\n    'history': false,\n    'size': _app_class__WEBPACK_IMPORTED_MODULE_0__.ImageSize.regular,\n    'keyword': 'Sakura',\n    'shortcuts': [\n        {\n            'title': 'Google',\n            'link': 'https://google.com',\n            'img': 'icons/google.png',\n        },\n        {\n            'title': 'Twitter',\n            'link': 'https://twitter.com',\n            'img': 'icons/twitter.png',\n        },\n        {\n            'title': 'Apple',\n            'link': 'https://apple.com',\n            'img': 'icons/applestore.png',\n        },\n        {\n            'title': 'Instagram',\n            'link': 'https://instagram.com',\n            'img': 'icons/instagram.png',\n        },\n        {\n            'title': 'YouTube',\n            'link': 'https://youtube.com',\n            'img': 'icons/youtube.png',\n        },\n        {\n            'title': 'Amazon',\n            'link': 'https://amazon.co.jp',\n            'img': 'icons/amazon.png',\n        },\n        {\n            'title': 'GitHub',\n            'link': 'https://github.com',\n            'img': 'icons/github.png',\n        },\n        {\n            'title': 'Google Translate',\n            'link': 'https://translate.google.com',\n            'img': 'icons/translate.png',\n        },\n    ],\n};\n\n\n//# sourceURL=webpack://Safari-Clean-Newtab/./src/config.ts?");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval devtool is used.
/******/ 	var __webpack_exports__ = __webpack_require__("./index.ts");
/******/ 	
/******/ })()
;